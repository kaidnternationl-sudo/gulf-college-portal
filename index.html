<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام القبول الإلكتروني - كلية الخليج</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0055A4;
            --primary-dark: #003366;
            --secondary-color: #FFD700;
            --accent-color: #00A86B;
            --success-color: #2e7d32;
            --warning-color: #f57c00;
            --error-color: #d32f2f;
            --gray-light: #f5f5f5;
            --gray-medium: #e0e0e0;
            --gray-dark: #666;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Tahoma', 'Geneva', 'Verdana', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }
        
        /* ========== STEERER UI ========== */
        .stepper-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 85, 164, 0.1);
        }
        
        .stepper {
            display: flex;
            justify-content: space-between;
            position: relative;
        }
        
        .stepper::before {
            content: '';
            position: absolute;
            top: 24px;
            right: 0;
            left: 0;
            height: 3px;
            background: var(--gray-medium);
            z-index: 1;
        }
        
        .step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }
        
        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--gray-medium);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            font-size: 18px;
            color: var(--gray-dark);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .step.active .step-circle {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 85, 164, 0.3);
        }
        
        .step.completed .step-circle {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }
        
        .step.completed .step-circle::after {
            content: '✓';
            font-size: 20px;
        }
        
        .step-label {
            font-size: 14px;
            color: var(--gray-dark);
            font-weight: 600;
        }
        
        .step.active .step-label {
            color: var(--primary-color);
            font-weight: 700;
        }
        
        /* ========== MAIN CONTENT ========== */
        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0, 85, 164, 0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            color: white;
            padding: 30px 40px;
            text-align: center;
            border-bottom: 8px solid var(--secondary-color);
            position: relative;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .content {
            padding: 40px;
        }
        
        .step-content {
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        .step-content.active {
            display: block;
        }
        
        /* ========== SMART WIDGET ========== */
        .smart-widget {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 85, 164, 0.15);
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        
        .widget-header {
            background: linear-gradient(135deg, var(--accent-color), #00A86B);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .widget-header h3 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .calculator-widget {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
            border-radius: 10px;
            border: 2px solid #81c784;
        }
        
        .fee-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #81c784;
        }
        
        .fee-total {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid var(--accent-color);
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-dark);
        }
        
        .eligibility-box {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd, #f3f9ff);
            border-radius: 10px;
            border: 2px solid #90caf9;
        }
        
        .eligibility-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 5px;
            background: white;
        }
        
        .eligibility-item.eligible {
            border-right: 3px solid var(--success-color);
        }
        
        .eligibility-item.not-eligible {
            border-right: 3px solid var(--error-color);
        }
        
        /* ========== AI RECOMMENDATIONS ========== */
        .recommendation-box {
            background: linear-gradient(135deg, #fff3e0, #fff8e1);
            border: 2px solid var(--warning-color);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }
        
        .recommendation-box h4 {
            color: var(--warning-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .recommendation-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 85, 164, 0.2);
        }
        
        /* ========== FORM STYLES ========== */
        .form-section {
            margin-bottom: 40px;
            border-bottom: 2px solid var(--gray-light);
            padding-bottom: 30px;
        }
        
        .form-section:last-of-type {
            border-bottom: none;
        }
        
        .section-title {
            color: var(--primary-dark);
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 15px;
        }
        
        .form-group label.required::after {
            content: ' *';
            color: var(--error-color);
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--gray-medium);
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 85, 164, 0.15);
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-dark);
        }
        
        /* ========== BUTTONS ========== */
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid var(--gray-light);
        }
        
        .btn {
            padding: 16px 35px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            box-shadow: 0 5px 15px rgba(0, 85, 164, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 85, 164, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #757575, #616161);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--accent-color), #2e7d32);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(46, 125, 50, 0.4);
        }
        
        /* ========== ANIMATIONS ========== */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ========== RESPONSIVE ========== */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .smart-widget {
                position: static;
                margin-top: 30px;
            }
        }
        
        @media (max-width: 768px) {
            .content {
                padding: 25px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .button-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* ========== SPECIAL EFFECTS ========== */
        .status-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 85, 164, 0.3);
            animation: fadeIn 0.5s ease;
        }
        
        .program-card {
            background: white;
            border: 2px solid var(--gray-medium);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .program-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 85, 164, 0.1);
        }
        
        .program-card.selected {
            background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
            border-color: var(--accent-color);
        }
        
        .program-card.disabled {
            opacity: 0.5;
            pointer-events: none;
            background: var(--gray-light);
        }
        
        .program-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .program-title {
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 16px;
        }
        
        .program-details {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: var(--gray-dark);
        }
        
        .gpa-badge {
            background: var(--secondary-color);
            color: var(--primary-dark);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .validation-box {
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd, #f3f9ff);
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--primary-color);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success-message {
            background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
            color: var(--success-color);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            display: none;
            animation: fadeIn 0.8s ease;
        }
        
        .success-message h2 {
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .error-message {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            color: var(--error-color);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid var(--error-color);
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1><i class="fas fa-university"></i> نظام القبول الإلكتروني - كلية الخليج</h1>
                <p>نظام متطور يحلل بياناتك ويوصي بأفضل التخصصات بناءً على مؤهلاتك</p>
            </div>
            
            <!-- Stepper -->
            <div class="stepper-container">
                <div class="stepper">
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">البيانات الشخصية</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">المؤهل الأكاديمي</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">اختيار التخصص</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-circle">4</div>
                        <div class="step-label">التأكيد والإرسال</div>
                    </div>
                </div>
            </div>
            
            <!-- Content -->
            <div class="content">
                <!-- Step 1: Personal Information -->
                <div id="step1" class="step-content active">
                    <div class="form-section">
                        <div class="section-title">
                            <i class="fas fa-user-circle"></i>
                            <span>البيانات الشخصية</span>
                        </div>
                        
                        <div class="validation-box" id="idValidation">
                            <i class="fas fa-check-circle"></i>
                            <strong>التحقق التلقائي:</strong> النظام يحدد نوع المتقدم وجنسيته تلقائياً من رقم الهوية
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="required">الاسم الكامل</label>
                                <div class="input-with-icon">
                                    <input type="text" id="fullName" placeholder="الاسم الثلاثي على الأقل" required>
                                    <i class="fas fa-user input-icon"></i>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="required">رقم الهوية / الإقامة</label>
                                <div class="input-with-icon">
                                    <input type="text" id="idNumber" placeholder="10 أو 11 رقماً" required>
                                    <i class="fas fa-id-card input-icon"></i>
                                </div>
                                <small id="idTypeInfo" style="color: var(--gray-dark); display: block; margin-top: 5px;"></small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="required">الجنس</label>
                                <select id="gender" required>
                                    <option value="">اختر الجنس</option>
                                    <option value="ذكر">ذكر</option>
                                    <option value="أنثى">أنثى</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="required">الجنسية</label>
                                <select id="nationality" required>
                                    <option value="">اختر الجنسية</option>
                                    <option value="سعودي">سعودي</option>
                                    <option value="غير سعودي">غير سعودي</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="required">نوع المتقدم</label>
                                <select id="applicantType" required>
                                    <option value="">اختر النوع</option>
                                    <option value="new">خريج ثانوي جديد</option>
                                    <option value="bridging">برنامج التجسير</option>
                                    <option value="transfer">منقول من جامعة أخرى</option>
                                    <option value="international">طالب دولي</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="required">البريد الإلكتروني</label>
                                <div class="input-with-icon">
                                    <input type="email" id="email" placeholder="example@domain.com" required>
                                    <i class="fas fa-envelope input-icon"></i>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="required">رقم الجوال</label>
                                <div class="input-with-icon">
                                    <input type="tel" id="phone" placeholder="05XXXXXXXX" required>
                                    <i class="fas fa-phone input-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recommendation-box" id="step1Recommendation" style="display: none;">
                        <h4><i class="fas fa-lightbulb"></i> توجيهات النظام</h4>
                        <p id="recommendationText1"></p>
                    </div>
                    
                    <div class="button-container">
                        <button class="btn btn-primary" onclick="nextStep()">
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Step 2: Academic Information -->
                <div id="step2" class="step-content">
                    <div class="form-section">
                        <div class="section-title">
                            <i class="fas fa-graduation-cap"></i>
                            <span>المؤهل الأكاديمي</span>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="required">نوع المؤهل</label>
                                <select id="qualificationType" required>
                                    <option value="">اختر نوع المؤهل</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="required">تخصص الثانوية</label>
                                <select id="specialization" required>
                                    <option value="">اختر التخصص</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="required">المعدل التراكمي</label>
                                <div class="input-with-icon">
                                    <input type="number" id="gpa" min="50" max="100" step="0.01" placeholder="مثال: 85.50" required>
                                    <i class="fas fa-chart-line input-icon"></i>
                                </div>
                                <small style="color: var(--gray-dark); display: block; margin-top: 5px;">
                                    المعدل المنخفض (أقل من 70) يفتح أبواب الدبلوم المهني
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label>درجة القدرات (اختياري)</label>
                                <div class="input-with-icon">
                                    <input type="number" id="aptitudeScore" min="0" max="100" placeholder="اختياري">
                                    <i class="fas fa-brain input-icon"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bridging Fields -->
                        <div id="bridgingFields" style="display: none;">
                            <div class="form-section">
                                <div class="section-title">
                                    <i class="fas fa-bridge"></i>
                                    <span>بيانات برنامج التجسير</span>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>الجامعة السابقة</label>
                                        <input type="text" id="bridgingUniversity" placeholder="اسم الجامعة">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>تخصص الدبلوم</label>
                                        <input type="text" id="diplomaSpecialty" placeholder="التخصص">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>نظام المعدل</label>
                                        <select id="gpaSystem">
                                            <option value="5">من 5</option>
                                            <option value="4">من 4</option>
                                            <option value="100">نسبة مئوية</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>معدل الدبلوم</label>
                                        <input type="number" id="diplomaGPA" step="0.01" placeholder="مثال: 3.75">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recommendation-box" id="step2Recommendation" style="display: none;">
                        <h4><i class="fas fa-lightbulb"></i> توصيات النظام بناءً على معدلك</h4>
                        <div id="recommendationGrid" class="recommendation-grid"></div>
                    </div>
                    
                    <div class="button-container">
                        <button class="btn btn-secondary" onclick="prevStep()">
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button class="btn btn-primary" onclick="nextStep()">
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Step 3: Program Selection -->
                <div id="step3" class="step-content">
                    <div class="form-section">
                        <div class="section-title">
                            <i class="fas fa-university"></i>
                            <span>اختيار الكلية والتخصص</span>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="required">نوع الدراسة</label>
                                <select id="studyType" required>
                                    <option value="">اختر نوع الدراسة</option>
                                    <option value="منتظم">منتظم (حضوري)</option>
                                    <option value="عن بعد">تعليم عن بعد</option>
                                    <option value="مدمج">تعليم مدمج</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="required">نظام الدراسة</label>
                                <select id="studySystem" required>
                                    <option value="">اختر النظام</option>
                                    <option value="فصول">نظام الفصول</option>
                                    <option value="ساعات">نظام الساعات المعتمدة</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="required">اختر الكلية</label>
                            <select id="collegeSelect" required>
                                <option value="">اختر الكلية أولاً</option>
                            </select>
                        </div>
                        
                        <div id="programsContainer">
                            <!-- سيتم ملؤها بالبرامج الموصى بها -->
                        </div>
                    </div>
                    
                    <div class="button-container">
                        <button class="btn btn-secondary" onclick="prevStep()">
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button class="btn btn-primary" onclick="nextStep()">
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Step 4: Review and Submit -->
                <div id="step4" class="step-content">
                    <!-- Web3Forms Form (Hidden) -->
                    <form id="web3formsForm" style="display: none;">
                        <input type="hidden" name="access_key" value="8f907260-fc10-46e0-b5b6-422b56f45c19">
                        <input type="hidden" name="subject" value="طلب تسجيل جديد - كلية الخليج">
                        <input type="hidden" name="from_name" value="نظام القبول الإلكتروني">
                        
                        <!-- إعدادات إضافية لـ Web3Forms -->
                        <input type="checkbox" name="botcheck" style="display: none;">
                        
                        <!-- بيانات النموذج -->
                        <input type="hidden" name="الاسم_الكامل" id="wf_fullName">
                        <input type="hidden" name="رقم_الهوية" id="wf_idNumber">
                        <input type="hidden" name="الجنس" id="wf_gender">
                        <input type="hidden" name="الجنسية" id="wf_nationality">
                        <input type="hidden" name="نوع_المتقدم" id="wf_applicantType">
                        <input type="hidden" name="البريد_الإلكتروني" id="wf_email">
                        <input type="hidden" name="رقم_الجوال" id="wf_phone">
                        <input type="hidden" name="نوع_المؤهل" id="wf_qualificationType">
                        <input type="hidden" name="تخصص_الثانوية" id="wf_specialization">
                        <input type="hidden" name="المعدل_التراكمي" id="wf_gpa">
                        <input type="hidden" name="درجة_القدرات" id="wf_aptitudeScore">
                        <input type="hidden" name="نوع_الدراسة" id="wf_studyType">
                        <input type="hidden" name="نظام_الدراسة" id="wf_studySystem">
                        <input type="hidden" name="الكلية" id="wf_college">
                        <input type="hidden" name="التخصص_المختار" id="wf_program">
                        <input type="hidden" name="مدة_البرنامج" id="wf_duration">
                        <input type="hidden" name="الساعات_المعتمدة" id="wf_credits">
                        <input type="hidden" name="نسبة_المنحة" id="wf_scholarship">
                        <input type="hidden" name="الرسوم_المتوقعة" id="wf_totalFee">
                        <input type="hidden" name="الجامعة_السابقة" id="wf_bridgingUniversity">
                        <input type="hidden" name="تخصص_الدبلوم" id="wf_diplomaSpecialty">
                        <input type="hidden" name="معدل_الدبلوم" id="wf_diplomaGPA">
                        <input type="hidden" name="رقم_الطلب" id="wf_applicationNumber">
                        <input type="hidden" name="وقت_التقديم" id="wf_submissionTime">
                    </form>
                    
                    <div class="form-section">
                        <div class="section-title">
                            <i class="fas fa-clipboard-check"></i>
                            <span>مراجعة الطلب</span>
                        </div>
                        
                        <div id="reviewData" style="padding: 20px; background: var(--gray-light); border-radius: 10px; margin-bottom: 30px;">
                            <!-- سيتم ملؤها ببيانات المراجعة -->
                        </div>
                        
                        <!-- رسالة الخطأ -->
                        <div class="error-message" id="errorMessage">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span id="errorText"></span>
                        </div>
                        
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-file-signature"></i>
                                <span>الموافقة النهائية</span>
                            </div>
                            
                            <div style="padding: 20px; background: #f9f9f9; border-radius: 10px; border: 2px solid var(--gray-medium);">
                                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                                    <input type="checkbox" id="termsAgreement" style="width: auto;" required>
                                    <label for="termsAgreement" style="margin: 0; color: var(--primary-dark); line-height: 1.6;">
                                        أوافق على جميع الشروط والأحكام، وأقر بصدق البيانات المقدمة وأتحمل المسؤولية القانونية عن أي معلومات غير صحيحة.
                                    </label>
                                </div>
                                
                                <div style="display: flex; gap: 15px;">
                                    <input type="checkbox" id="paymentAgreement" style="width: auto;">
                                    <label for="paymentAgreement" style="margin: 0; color: var(--primary-dark); line-height: 1.6;">
                                        أوافق على أن الرسوم الدراسية ستدفع وفقاً للجدول الزمني المعتمد من الشؤون الإدارية والمالية.
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="success-message" id="successMessage">
                        <i class="fas fa-check-circle" style="font-size: 60px; margin-bottom: 20px;"></i>
                        <h2>تم إرسال طلبك بنجاح!</h2>
                        <p style="margin-bottom: 15px; font-size: 18px;">رقم الطلب: <strong id="applicationNumber"></strong></p>
                        <p style="color: var(--gray-dark);">سيتم التواصل معك خلال 48 ساعة عمل</p>
                        <button class="btn btn-success" onclick="location.reload()" style="margin-top: 30px;">
                            <i class="fas fa-redo"></i> تقديم طلب جديد
                        </button>
                    </div>
                    
                    <div class="button-container">
                        <button class="btn btn-secondary" onclick="prevStep()">
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button class="btn btn-success" onclick="submitApplication()" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> إرسال الطلب
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Smart Widget -->
        <div class="smart-widget">
            <div class="widget-header">
                <h3><i class="fas fa-calculator"></i> حاسبة الرسوم</h3>
                <p>تحليل فوري للرسوم والأهلية</p>
            </div>
            
            <div class="calculator-widget">
                <h4 style="color: var(--primary-dark); margin-bottom: 15px;">تفاصيل الرسوم</h4>
                <div class="fee-item">
                    <span>رسوم الساعة الدراسية</span>
                    <span id="hourlyFee">0 ريال</span>
                </div>
                <div class="fee-item">
                    <span>عدد الساعات المقدر</span>
                    <span id="estimatedHours">0 ساعة</span>
                </div>
                <div class="fee-item">
                    <span>رسوم التسجيل</span>
                    <span id="registrationFee">500 ريال</span>
                </div>
                <div class="fee-item">
                    <span>رسوم التقنية (عن بعد)</span>
                    <span id="techFee">0 ريال</span>
                </div>
                <div class="fee-total">
                    <span>الإجمالي المتوقع</span>
                    <span id="totalFee">0 ريال</span>
                </div>
            </div>
            
            <div class="eligibility-box">
                <h4 style="color: var(--primary-dark); margin-bottom: 15px;">تحليل الأهلية</h4>
                <div id="eligibilityStatus">
                    <!-- سيتم ملؤها تلقائياً -->
                </div>
            </div>
            
            <div style="margin-top: 25px; padding: 15px; background: linear-gradient(135deg, #fff3e0, #fff8e1); border-radius: 10px;">
                <h4 style="color: var(--warning-color); margin-bottom: 10px;">
                    <i class="fas fa-clock"></i> التقديم المبكر
                </h4>
                <p style="font-size: 14px; color: var(--gray-dark);">
                    التقديم قبل 30/06 يؤهلك لخصم 10% على الرسوم الدراسية
                </p>
            </div>
        </div>
    </div>
    
    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator">
        <i class="fas fa-sync-alt"></i> النظام يعمل...
    </div>

    <script>
    // ============ STATE MANAGEMENT ENGINE ============
    const State = {
        currentStep: 1,
        applicantType: 'new',
        gender: '',
        nationality: '',
        gpa: 0,
        studyType: '',
        selectedProgram: null,
        selectedCollege: null,
        
        // القاعدة المعرفية للتخصصات
        knowledgeBase: {
            colleges: [
                {
                    id: 1,
                    name: "كلية العلوم الإدارية والمالية",
                    minGPA: 60,
                    hourPrice: 350,
                    programs: [
                        { id: 101, name: "بكالوريوس إدارة الأعمال", minGPA: 65, duration: 4, credits: 120, gender: 'both', availableFor: ['new', 'bridging', 'transfer'], scholarship: 5 },
                        { id: 102, name: "بكالوريوس المحاسبة", minGPA: 70, duration: 4, credits: 120, gender: 'both', availableFor: ['new', 'bridging', 'transfer'], scholarship: 10 },
                        { id: 103, name: "دبلوم إدارة الأعمال", minGPA: 60, duration: 2, credits: 60, gender: 'both', availableFor: ['new'], scholarship: 0 },
                        { id: 104, name: "دبلوم الموارد البشرية", minGPA: 60, duration: 2, credits: 60, gender: 'both', availableFor: ['new', 'bridging'], scholarship: 0 }
                    ]
                },
                {
                    id: 2,
                    name: "كلية علوم الحاسب وتقنية المعلومات",
                    minGPA: 70,
                    hourPrice: 400,
                    programs: [
                        { id: 201, name: "بكالوريوس علوم الحاسب", minGPA: 75, duration: 4, credits: 120, gender: 'both', availableFor: ['new', 'bridging', 'transfer'], scholarship: 15 },
                        { id: 202, name: "بكالوريوس الأمن السيبراني", minGPA: 80, duration: 4, credits: 120, gender: 'both', availableFor: ['new', 'bridging'], scholarship: 20 },
                        { id: 203, name: "دبلوم تقنية المعلومات", minGPA: 65, duration: 2, credits: 60, gender: 'both', availableFor: ['new'], scholarship: 0 },
                        { id: 204, name: "دبلوم شبكات الحاسب", minGPA: 65, duration: 2, credits: 60, gender: 'both', availableFor: ['new', 'bridging'], scholarship: 0 }
                    ]
                },
                {
                    id: 3,
                    name: "كلية الهندسة",
                    minGPA: 80,
                    hourPrice: 450,
                    programs: [
                        { id: 301, name: "بكالوريوس الهندسة المدنية", minGPA: 85, duration: 5, credits: 150, gender: 'ذكر', availableFor: ['new', 'transfer'], scholarship: 25 },
                        { id: 302, name: "بكالوريوس الهندسة الكهربائية", minGPA: 85, duration: 5, credits: 150, gender: 'ذكر', availableFor: ['new', 'transfer'], scholarship: 25 },
                        { id: 303, name: "دبلوم الهندسة المدنية", minGPA: 70, duration: 2, credits: 60, gender: 'ذكر', availableFor: ['new', 'bridging'], scholarship: 0 },
                        { id: 304, name: "دبلوم الهندسة الميكانيكية", minGPA: 70, duration: 2, credits: 60, gender: 'ذكر', availableFor: ['new', 'bridging'], scholarship: 0 }
                    ]
                },
                {
                    id: 4,
                    name: "كلية العلوم الطبية والصحية",
                    minGPA: 85,
                    hourPrice: 500,
                    programs: [
                        { id: 401, name: "بكالوريوس التمريض", minGPA: 80, duration: 4, credits: 120, gender: 'both', availableFor: ['new', 'bridging'], scholarship: 30 },
                        { id: 402, name: "دبلوم التمريض", minGPA: 75, duration: 2, credits: 60, gender: 'both', availableFor: ['new'], scholarship: 0 },
                        { id: 403, name: "بكالوريوس المختبرات الطبية", minGPA: 85, duration: 4, credits: 120, gender: 'both', availableFor: ['new', 'bridging'], scholarship: 20 },
                        { id: 404, name: "دبلوم الصيدلة", minGPA: 75, duration: 2, credits: 60, gender: 'both', availableFor: ['new', 'bridging'], scholarship: 0 }
                    ]
                },
                {
                    id: 5,
                    name: "كلية القانون",
                    minGPA: 75,
                    hourPrice: 380,
                    programs: [
                        { id: 501, name: "بكالوريوس القانون", minGPA: 75, duration: 4, credits: 120, gender: 'both', availableFor: ['new', 'bridging', 'transfer'], scholarship: 10 },
                        { id: 502, name: "دبلوم الأنظمة السعودية", minGPA: 65, duration: 2, credits: 60, gender: 'both', availableFor: ['new'], scholarship: 0 },
                        { id: 503, name: "برنامج التجسير في القانون", minGPA: 70, duration: 2, credits: 60, gender: 'both', availableFor: ['bridging'], scholarship: 5 }
                    ]
                },
                {
                    id: 6,
                    name: "كلية العلوم الطبية التطبيقية",
                    minGPA: 80,
                    hourPrice: 420,
                    programs: [
                        { id: 601, name: "بكالوريوس الأشعة التشخيصية", minGPA: 85, duration: 4, credits: 120, gender: 'both', availableFor: ['new', 'bridging'], scholarship: 20 },
                        { id: 602, name: "بكالوريوس العلاج الطبيعي", minGPA: 85, duration: 4, credits: 120, gender: 'both', availableFor: ['new', 'bridging'], scholarship: 20 },
                        { id: 603, name: "دبلوم السجلات الطبية", minGPA: 70, duration: 2, credits: 60, gender: 'both', availableFor: ['new', 'bridging'], scholarship: 0 }
                    ]
                }
            ]
        },
        
        // تحديث الحقول المشروطة
        updateRequiredFields() {
            const applicantType = document.getElementById('applicantType').value;
            const bridgingFields = document.getElementById('bridgingFields');
            
            if (applicantType === 'bridging') {
                bridgingFields.style.display = 'block';
                // جعل الحقول إلزامية
                ['bridgingUniversity', 'diplomaSpecialty', 'diplomaGPA'].forEach(field => {
                    const el = document.getElementById(field);
                    if (el) el.required = true;
                });
            } else {
                bridgingFields.style.display = 'none';
                // إزالة الإلزامية
                ['bridgingUniversity', 'diplomaSpecialty', 'diplomaGPA'].forEach(field => {
                    const el = document.getElementById(field);
                    if (el) el.required = false;
                });
            }
        },
        
        // تحليل رقم الهوية
        analyzeIdNumber(id) {
            if (!id) return;
            
            const idTypeInfo = document.getElementById('idTypeInfo');
            if (id.startsWith('1')) {
                document.getElementById('nationality').value = 'سعودي';
                idTypeInfo.innerHTML = '<i class="fas fa-check-circle" style="color: green;"></i> تم التعرف: هوية سعودية';
            } else if (id.startsWith('2')) {
                document.getElementById('nationality').value = 'غير سعودي';
                idTypeInfo.innerHTML = '<i class="fas fa-info-circle" style="color: orange;"></i> تم التعرف: إقامة';
            }
        }
    };

    // ============ ADMISSION ENGINE ============
    class AdmissionEngine {
        constructor() {
            this.initializeSystem();
        }
        
        initializeSystem() {
            console.log('🚀 نظام القبول الإلكتروني يعمل...');
            this.loadQualifications();
            this.loadSpecializations();
            this.loadColleges();
            this.setupEventListeners();
            this.updateStatusIndicator('النظام جاهز');
        }
        
        loadQualifications() {
            const qualifications = [
                'ثانوية عامة - علمي',
                'ثانوية عامة - أدبي',
                'ثانوية تجارية',
                'ثانوية صناعية',
                'ثانوية زراعية',
                'ثانوية فندقية',
                'ثانوية صحية',
                'ثانوية شرعية',
                'ثانوية تحفيظ القرآن',
                'دبلوم الكلية التقنية'
            ];
            
            const select = document.getElementById('qualificationType');
            qualifications.forEach(q => {
                const option = document.createElement('option');
                option.value = q;
                option.textContent = q;
                select.appendChild(option);
            });
        }
        
        loadSpecializations() {
            const specializations = {
                'العلمي': ['طبيعي', 'حاسب آلي', 'هندسي', 'أحياء', 'كيمياء', 'فيزياء'],
                'الأدبي': ['إداري', 'قانوني', 'شرعي', 'لغات', 'علوم إنسانية'],
                'التقني': ['كهرباء', 'ميكانيكا', 'إلكترونيات', 'حاسب آلي', 'بناء'],
                'الإداري': ['إدارة أعمال', 'محاسبة', 'سكرتارية', 'تسويق'],
                'الصحي': ['تمريض', 'صيدلة', 'مختبرات', 'أشعة', 'إسعاف']
            };
            
            const select = document.getElementById('specialization');
            for (const category in specializations) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = category;
                
                specializations[category].forEach(spec => {
                    const option = document.createElement('option');
                    option.value = spec;
                    option.textContent = spec;
                    optgroup.appendChild(option);
                });
                
                select.appendChild(optgroup);
            }
        }
        
        loadColleges() {
            const select = document.getElementById('collegeSelect');
            State.knowledgeBase.colleges.forEach(college => {
                const option = document.createElement('option');
                option.value = college.id;
                option.textContent = college.name;
                select.appendChild(option);
            });
        }
        
        setupEventListeners() {
            // تحليل رقم الهوية
            document.getElementById('idNumber').addEventListener('input', (e) => {
                State.analyzeIdNumber(e.target.value);
            });
            
            // تحديث الحقول المشروطة
            document.getElementById('applicantType').addEventListener('change', (e) => {
                State.applicantType = e.target.value;
                State.updateRequiredFields();
                this.updateStep1Recommendation();
            });
            
            // تحديث المعدل والتوصيات
            document.getElementById('gpa').addEventListener('input', (e) => {
                State.gpa = parseFloat(e.target.value) || 0;
                this.updateStep2Recommendation();
                this.updateFeesCalculator();
                this.updateEligibility();
            });
            
            // تحديث نوع الدراسة
            document.getElementById('studyType').addEventListener('change', (e) => {
                State.studyType = e.target.value;
                this.updateFeesCalculator();
            });
            
            // تحديث اختيار الكلية
            document.getElementById('collegeSelect').addEventListener('change', (e) => {
                this.loadRecommendedPrograms(e.target.value);
            });
            
            // تحديث الجنس
            document.getElementById('gender').addEventListener('change', (e) => {
                State.gender = e.target.value;
                this.updateStep1Recommendation();
                this.updateEligibility();
            });
        }
        
        updateStep1Recommendation() {
            const recommendation = document.getElementById('step1Recommendation');
            let text = '';
            
            if (State.applicantType === 'bridging') {
                text = 'برنامج التجسير مناسب لك إذا كان لديك دبلوم في مجال ذي صلة. ستحصل على خصم 5-10% على الرسوم.';
            } else if (State.applicantType === 'transfer') {
                text = 'برنامج النقل يتطلب معادلة الساعات. سيتم احتساب الساعات المتبقية بناءً على سجلك الأكاديمي.';
            } else if (State.applicantType === 'international') {
                text = 'الطلاب الدوليون يتطلبون تصريح إقامة ساري المفعول. الرسوم أعلى بنسبة 20%.';
            } else {
                text = 'كخريج ثانوي جديد، أنت مؤهل لجميع برامج البكالوريوس والدبلوم التي تناسب معدلك.';
            }
            
            document.getElementById('recommendationText1').textContent = text;
            recommendation.style.display = 'block';
        }
        
        updateStep2Recommendation() {
            const gpa = State.gpa;
            const recommendation = document.getElementById('step2Recommendation');
            const grid = document.getElementById('recommendationGrid');
            
            if (gpa < 60) {
                recommendation.style.display = 'none';
                return;
            }
            
            recommendation.style.display = 'block';
            grid.innerHTML = '';
            
            let recommendations = [];
            
            if (gpa >= 90) {
                recommendations = [
                    { title: 'الهندسة', desc: 'متاح مع منحة 25%', icon: 'fas fa-cogs', color: '#0055A4' },
                    { title: 'الطب والعلوم الصحية', desc: 'متاح مع منحة 30%', icon: 'fas fa-heartbeat', color: '#d32f2f' },
                    { title: 'الأمن السيبراني', desc: 'متاح مع منحة 20%', icon: 'fas fa-shield-alt', color: '#00A86B' },
                    { title: 'برامج البكالوريوس المميزة', desc: 'جميع التخصصات متاحة', icon: 'fas fa-medal', color: '#FFD700' }
                ];
            } else if (gpa >= 80) {
                recommendations = [
                    { title: 'علوم الحاسب', desc: 'متاح مع منحة 15%', icon: 'fas fa-laptop-code', color: '#0055A4' },
                    { title: 'العلوم الإدارية', desc: 'متاح مع منحة 10%', icon: 'fas fa-chart-line', color: '#00A86B' },
                    { title: 'برامج البكالوريوس', desc: 'معظم التخصصات متاحة', icon: 'fas fa-graduation-cap', color: '#f57c00' },
                    { title: 'التخصصات الطبية المساندة', desc: 'متاح مع منحة 20%', icon: 'fas fa-user-md', color: '#d32f2f' }
                ];
            } else if (gpa >= 70) {
                recommendations = [
                    { title: 'برامج الدبلوم المتقدمة', desc: 'مسار سريع للتوظيف', icon: 'fas fa-certificate', color: '#0055A4' },
                    { title: 'التجسير للبكالوريوس', desc: 'مسار للترقية', icon: 'fas fa-bridge', color: '#00A86B' },
                    { title: 'التخصصات التقنية', desc: 'طلب كبير في سوق العمل', icon: 'fas fa-tools', color: '#f57c00' },
                    { title: 'الإدارة والمحاسبة', desc: 'فرص وظيفية واسعة', icon: 'fas fa-briefcase', color: '#757575' }
                ];
            } else {
                recommendations = [
                    { title: 'برامج الدبلوم المهنية', desc: 'تأهيل سريع للعمل', icon: 'fas fa-hammer', color: '#0055A4' },
                    { title: 'التدريب التقني', desc: 'شهادات معتمدة', icon: 'fas fa-user-graduate', color: '#00A86B' },
                    { title: 'التخصصات العملية', desc: 'تركيز على المهارات', icon: 'fas fa-hands-helping', color: '#f57c00' },
                    { title: 'تحسين المهارات', desc: 'دورات تأهيلية', icon: 'fas fa-chart-line', color: '#757575' }
                ];
            }
            
            recommendations.forEach(rec => {
                const card = document.createElement('div');
                card.className = 'recommendation-card';
                card.innerHTML = `
                    <i class="${rec.icon}" style="font-size: 24px; color: ${rec.color}; margin-bottom: 10px;"></i>
                    <div style="font-weight: 600; color: ${rec.color};">${rec.title}</div>
                    <div style="font-size: 12px; color: var(--gray-dark); margin-top: 5px;">${rec.desc}</div>
                `;
                grid.appendChild(card);
            });
        }
        
        loadRecommendedPrograms(collegeId) {
            const container = document.getElementById('programsContainer');
            container.innerHTML = '';
            
            const college = State.knowledgeBase.colleges.find(c => c.id == collegeId);
            if (!college) return;
            
            const gpa = State.gpa || 0;
            const gender = State.gender;
            const applicantType = State.applicantType;
            
            college.programs.forEach(program => {
                // التحقق من الأهلية
                const isEligible = gpa >= program.minGPA;
                const genderMatch = program.gender === 'both' || program.gender === gender;
                const typeMatch = program.availableFor.includes(applicantType);
                
                const card = document.createElement('div');
                card.className = `program-card ${isEligible && genderMatch && typeMatch ? '' : 'disabled'}`;
                card.dataset.programId = program.id;
                
                card.innerHTML = `
                    <div class="program-header">
                        <div class="program-title">${program.name}</div>
                        <div class="gpa-badge">${program.minGPA}%</div>
                    </div>
                    <div class="program-details">
                        <span><i class="fas fa-clock"></i> ${program.duration} سنوات</span>
                        <span><i class="fas fa-book"></i> ${program.credits} ساعة</span>
                        <span><i class="fas fa-money-bill-wave"></i> ${program.scholarship}% منحة</span>
                    </div>
                `;
                
                if (isEligible && genderMatch && typeMatch) {
                    card.addEventListener('click', () => this.selectProgram(program, college));
                }
                
                container.appendChild(card);
            });
        }
        
        selectProgram(program, college) {
            State.selectedProgram = program;
            State.selectedCollege = college;
            
            // إزالة التحديد السابق
            document.querySelectorAll('.program-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // إضافة التحديد الحالي
            const selectedCard = document.querySelector(`[data-program-id="${program.id}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
            
            this.updateFeesCalculator();
            this.updateEligibility();
        }
        
        updateFeesCalculator() {
            if (!State.selectedProgram || !State.selectedCollege) return;
            
            const program = State.selectedProgram;
            const college = State.selectedCollege;
            const studyType = State.studyType;
            
            // حساب الساعات
            let hours = program.credits;
            if (State.applicantType === 'bridging') {
                hours = Math.max(60, program.credits - 60);
            } else if (State.applicantType === 'transfer') {
                hours = Math.max(30, program.credits - 90);
            }
            
            // حساب الرسوم
            let hourlyFee = college.hourPrice;
            let registrationFee = 500;
            let techFee = studyType === 'عن بعد' ? 1000 : 0;
            
            // تطبيق الخصم المبكر
            const earlyDiscount = new Date().getMonth() <= 5 ? 0.1 : 0;
            const scholarshipDiscount = program.scholarship / 100;
            const totalDiscount = earlyDiscount + scholarshipDiscount;
            
            const totalFee = (hours * hourlyFee + registrationFee + techFee) * (1 - totalDiscount);
            
            // تحديث الواجهة
            document.getElementById('hourlyFee').textContent = `${hourlyFee} ريال`;
            document.getElementById('estimatedHours').textContent = `${hours} ساعة`;
            document.getElementById('registrationFee').textContent = `${registrationFee} ريال`;
            document.getElementById('techFee').textContent = `${techFee} ريال`;
            document.getElementById('totalFee').textContent = `${Math.round(totalFee)} ريال`;
        }
        
        updateEligibility() {
            const container = document.getElementById('eligibilityStatus');
            container.innerHTML = '';
            
            const checks = [
                {
                    name: 'المعدل التراكمي',
                    check: () => State.gpa >= (State.selectedProgram?.minGPA || 60),
                    message: 'معدلك مؤهل لهذا البرنامج'
                },
                {
                    name: 'الجنس',
                    check: () => !State.selectedProgram || 
                           State.selectedProgram.gender === 'both' || 
                           State.selectedProgram.gender === State.gender,
                    message: 'التخصص متاح لجنسك'
                },
                {
                    name: 'نوع المتقدم',
                    check: () => !State.selectedProgram || 
                           State.selectedProgram.availableFor.includes(State.applicantType),
                    message: 'نوع متقدمك مؤهل'
                },
                {
                    name: 'الرسوم',
                    check: () => true,
                    message: 'الرسوم مناسبة لميزانيتك'
                }
            ];
            
            checks.forEach(check => {
                const isEligible = check.check();
                const item = document.createElement('div');
                item.className = `eligibility-item ${isEligible ? 'eligible' : 'not-eligible'}`;
                item.innerHTML = `
                    <i class="fas fa-${isEligible ? 'check-circle' : 'times-circle'}" 
                       style="color: ${isEligible ? 'green' : 'red'}"></i>
                    <span>${check.name}: ${check.message}</span>
                `;
                container.appendChild(item);
            });
        }
        
        updateStatusIndicator(message) {
            const indicator = document.getElementById('statusIndicator');
            indicator.innerHTML = `<i class="fas fa-sync-alt"></i> ${message}`;
        }
        
        validateStep(step) {
            switch(step) {
                case 1:
                    return this.validateStep1();
                case 2:
                    return this.validateStep2();
                case 3:
                    return this.validateStep3();
                case 4:
                    return this.validateStep4();
                default:
                    return false;
            }
        }
        
        validateStep1() {
            const required = ['fullName', 'idNumber', 'gender', 'nationality', 'applicantType', 'email', 'phone'];
            let isValid = true;
            
            required.forEach(field => {
                const element = document.getElementById(field);
                if (!element.value.trim()) {
                    element.style.borderColor = 'var(--error-color)';
                    isValid = false;
                } else {
                    element.style.borderColor = '';
                }
            });
            
            // التحقق من صحة البريد الإلكتروني
            const email = document.getElementById('email').value;
            if (email && !this.validateEmail(email)) {
                document.getElementById('email').style.borderColor = 'var(--error-color)';
                isValid = false;
            }
            
            // التحقق من صحة رقم الجوال
            const phone = document.getElementById('phone').value;
            if (phone && !this.validatePhone(phone)) {
                document.getElementById('phone').style.borderColor = 'var(--error-color)';
                isValid = false;
            }
            
            return isValid;
        }
        
        validateStep2() {
            const gpa = parseFloat(document.getElementById('gpa').value);
            if (!gpa || gpa < 50 || gpa > 100) {
                document.getElementById('gpa').style.borderColor = 'var(--error-color)';
                return false;
            }
            
            // إذا كان نوع المتقدم هو تجسير، تحقق من الحقول الإضافية
            if (State.applicantType === 'bridging') {
                const required = ['bridgingUniversity', 'diplomaSpecialty', 'diplomaGPA'];
                let isValid = true;
                
                required.forEach(field => {
                    const element = document.getElementById(field);
                    if (!element.value.trim()) {
                        element.style.borderColor = 'var(--error-color)';
                        isValid = false;
                    } else {
                        element.style.borderColor = '';
                    }
                });
                
                return isValid;
            }
            
            return true;
        }
        
        validateStep3() {
            if (!State.selectedProgram) {
                alert('يرجى اختيار تخصص من القائمة');
                return false;
            }
            return true;
        }
        
        validateStep4() {
            return document.getElementById('termsAgreement').checked;
        }
        
        validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        validatePhone(phone) {
            const re = /^05\d{8}$/;
            return re.test(phone);
        }
        
        generateApplicationNumber() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `GULF-${timestamp.toString().slice(-6)}-${random}`;
        }
        
        async submitToWeb3Forms(formData) {
            try {
                // تعبئة بيانات النموذج المخفي
                document.getElementById('wf_fullName').value = formData.personal.fullName;
                document.getElementById('wf_idNumber').value = formData.personal.idNumber;
                document.getElementById('wf_gender').value = formData.personal.gender;
                document.getElementById('wf_nationality').value = formData.personal.nationality;
                document.getElementById('wf_applicantType').value = this.getApplicantTypeText(formData.personal.applicantType);
                document.getElementById('wf_email').value = formData.personal.email;
                document.getElementById('wf_phone').value = formData.personal.phone;
                document.getElementById('wf_qualificationType').value = formData.academic.qualification;
                document.getElementById('wf_specialization').value = formData.academic.specialization;
                document.getElementById('wf_gpa').value = formData.academic.gpa;
                document.getElementById('wf_aptitudeScore').value = formData.academic.aptitudeScore || 'غير محدد';
                document.getElementById('wf_studyType').value = formData.program.studyType;
                document.getElementById('wf_studySystem').value = formData.program.studySystem;
                document.getElementById('wf_college').value = formData.program.college;
                document.getElementById('wf_program').value = formData.program.program;
                document.getElementById('wf_duration').value = State.selectedProgram?.duration || '';
                document.getElementById('wf_credits').value = State.selectedProgram?.credits || '';
                document.getElementById('wf_scholarship').value = State.selectedProgram?.scholarship || 0;
                document.getElementById('wf_totalFee').value = document.getElementById('totalFee').textContent;
                document.getElementById('wf_bridgingUniversity').value = document.getElementById('bridgingUniversity').value || 'غير محدد';
                document.getElementById('wf_diplomaSpecialty').value = document.getElementById('diplomaSpecialty').value || 'غير محدد';
                document.getElementById('wf_diplomaGPA').value = document.getElementById('diplomaGPA').value || 'غير محدد';
                
                const appNumber = this.generateApplicationNumber();
                document.getElementById('wf_applicationNumber').value = appNumber;
                document.getElementById('wf_submissionTime').value = new Date().toLocaleString('ar-SA');
                
                // إعداد البيانات للإرسال
                const form = document.getElementById('web3formsForm');
                const formDataObj = new FormData(form);
                
                // إرسال إلى Web3Forms API
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    body: formDataObj
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('✅ تم الإرسال بنجاح إلى Web3Forms:', result);
                    return { success: true, appNumber: appNumber };
                } else {
                    console.error('❌ فشل الإرسال إلى Web3Forms:', result);
                    return { success: false, error: result.message || 'فشل الإرسال', appNumber: appNumber };
                }
            } catch (error) {
                console.error('❌ خطأ في الإرسال:', error);
                return { success: false, error: error.message || 'خطأ في الاتصال', appNumber: this.generateApplicationNumber() };
            }
        }
        
        getApplicantTypeText(type) {
            const types = {
                'new': 'خريج ثانوي جديد',
                'bridging': 'برنامج التجسير',
                'transfer': 'منقول من جامعة أخرى',
                'international': 'طالب دولي'
            };
            return types[type] || type;
        }
        
        async submitApplication() {
            // التحقق من الموافقة على الشروط
            if (!this.validateStep(4)) {
                this.showError('يرجى الموافقة على الشروط والأحكام');
                return;
            }

            this.updateStatusIndicator('جاري إرسال الطلب...');
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="loading"></span> جاري الإرسال...';
            submitBtn.disabled = true;

            // جمع البيانات
            const formData = this.collectFormData();
            
            // إرسال إلى Web3Forms
            const result = await this.submitToWeb3Forms(formData);
            
            if (result.success) {
                // حفظ في localStorage
                this.saveToLocalStorage(result.appNumber, formData);
                
                // عرض رسالة النجاح
                this.showSuccessMessage(result.appNumber);
                this.updateStatusIndicator('تم إرسال الطلب بنجاح!');
                
                // إخفاء زر الإرسال
                submitBtn.style.display = 'none';
            } else {
                // عرض رسالة الخطأ
                this.showError(`فشل إرسال الطلب: ${result.error || 'يرجى المحاولة مرة أخرى'}`);
                
                // حفظ الطلب محلياً رغم فشل الإرسال
                this.saveToLocalStorage(result.appNumber, formData);
                this.updateStatusIndicator('تم حفظ الطلب محلياً');
                
                // استعادة زر الإرسال
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }
        
        collectFormData() {
            return {
                personal: {
                    fullName: document.getElementById('fullName').value,
                    idNumber: document.getElementById('idNumber').value,
                    gender: document.getElementById('gender').value,
                    nationality: document.getElementById('nationality').value,
                    applicantType: document.getElementById('applicantType').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                },
                academic: {
                    qualification: document.getElementById('qualificationType').value,
                    specialization: document.getElementById('specialization').value,
                    gpa: document.getElementById('gpa').value,
                    aptitudeScore: document.getElementById('aptitudeScore').value
                },
                program: {
                    college: State.selectedCollege?.name || 'لم يتم الاختيار',
                    program: State.selectedProgram?.name || 'لم يتم الاختيار',
                    studyType: document.getElementById('studyType').value,
                    studySystem: document.getElementById('studySystem').value
                },
                fees: {
                    total: document.getElementById('totalFee').textContent
                }
            };
        }
        
        saveToLocalStorage(appNumber, formData) {
            const application = {
                id: appNumber,
                timestamp: new Date().toISOString(),
                data: formData,
                status: 'pending'
            };
            
            let applications = JSON.parse(localStorage.getItem('gulfApplications') || '[]');
            applications.push(application);
            localStorage.setItem('gulfApplications', JSON.stringify(applications));
            
            console.log('💾 تم حفظ الطلب محلياً:', appNumber);
        }
        
        showSuccessMessage(appNumber) {
            document.getElementById('applicationNumber').textContent = appNumber;
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }
        
        showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            errorDiv.style.display = 'block';
            
            // إخفاء رسالة الخطأ بعد 10 ثوان
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 10000);
        }
        
        // دالة لاختبار اتصال Web3Forms
        async testWeb3FormsConnection() {
            this.updateStatusIndicator('جاري اختبار الاتصال...');
            
            try {
                const testData = new FormData();
                testData.append('access_key', '8f907260-fc10-46e0-b5b6-422b56f45c19');
                testData.append('subject', 'اختبار اتصال النظام');
                testData.append('from_name', 'نظام القبول الإلكتروني');
                testData.append('الاسم_الكامل', 'اختبار اتصال');
                testData.append('البريد_الإلكتروني', 'test@example.com');
                testData.append('botcheck', '');
                
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    body: testData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('✅ الاتصال مع Web3Forms يعمل بشكل صحيح!');
                    this.updateStatusIndicator('الاتصال يعمل بنجاح');
                } else {
                    alert('⚠️ هناك مشكلة في الاتصال: ' + result.message);
                    this.updateStatusIndicator('مشكلة في الاتصال');
                }
            } catch (error) {
                alert('❌ فشل الاتصال: ' + error.message);
                this.updateStatusIndicator('فشل الاتصال');
            }
        }
    }

    // ============ STEP MANAGEMENT ============
    const engine = new AdmissionEngine();

    function nextStep() {
        if (!engine.validateStep(State.currentStep)) {
            engine.showError('يرجى ملء جميع الحقول المطلوبة بشكل صحيح');
            return;
        }
        
        // إخفاء رسالة الخطأ
        document.getElementById('errorMessage').style.display = 'none';
        
        // حفظ البيانات الحالية
        updateReviewData();
        
        // الانتقال للخطوة التالية
        document.querySelector(`#step${State.currentStep}`).classList.remove('active');
        document.querySelector(`.step[data-step="${State.currentStep}"]`).classList.remove('active');
        
        State.currentStep++;
        
        document.querySelector(`#step${State.currentStep}`).classList.add('active');
        document.querySelector(`.step[data-step="${State.currentStep}"]`).classList.add('active');
        
        // تحديث حالة الخطوات السابقة
        for (let i = 1; i < State.currentStep; i++) {
            document.querySelector(`.step[data-step="${i}"]`).classList.add('completed');
        }
        
        // إذا كانت الخطوة 3، قم بتحميل الكليات إذا لم تكن محملة
        if (State.currentStep === 3) {
            if (!State.selectedProgram) {
                const collegeSelect = document.getElementById('collegeSelect');
                if (collegeSelect.options.length <= 1) {
                    engine.loadColleges();
                }
            }
        }
    }

    function prevStep() {
        document.querySelector(`#step${State.currentStep}`).classList.remove('active');
        document.querySelector(`.step[data-step="${State.currentStep}"]`).classList.remove('active');
        
        State.currentStep--;
        
        document.querySelector(`#step${State.currentStep}`).classList.add('active');
        document.querySelector(`.step[data-step="${State.currentStep}"]`).classList.add('active');
    }

    function updateReviewData() {
        const container = document.getElementById('reviewData');
        const formData = engine.collectFormData();
        
        container.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;">البيانات الشخصية</h4>
                    <p><strong>الاسم:</strong> ${formData.personal.fullName}</p>
                    <p><strong>رقم الهوية:</strong> ${formData.personal.idNumber}</p>
                    <p><strong>الجنس:</strong> ${formData.personal.gender}</p>
                    <p><strong>الجنسية:</strong> ${formData.personal.nationality}</p>
                    <p><strong>نوع المتقدم:</strong> ${engine.getApplicantTypeText(formData.personal.applicantType)}</p>
                </div>
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;">البيانات الأكاديمية</h4>
                    <p><strong>المؤهل:</strong> ${formData.academic.qualification}</p>
                    <p><strong>التخصص:</strong> ${formData.academic.specialization}</p>
                    <p><strong>المعدل:</strong> ${formData.academic.gpa}%</p>
                    <p><strong>القدرات:</strong> ${formData.academic.aptitudeScore || 'غير محدد'}</p>
                </div>
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;">البرنامج المختار</h4>
                    <p><strong>الكلية:</strong> ${formData.program.college}</p>
                    <p><strong>التخصص:</strong> ${formData.program.program}</p>
                    <p><strong>نوع الدراسة:</strong> ${formData.program.studyType}</p>
                    <p><strong>نظام الدراسة:</strong> ${formData.program.studySystem}</p>
                    <p><strong>الرسوم المتوقعة:</strong> ${document.getElementById('totalFee').textContent}</p>
                </div>
            </div>
        `;
    }

    async function submitApplication() {
        await engine.submitApplication();
    }

    // ============ INITIALIZATION ============
    document.addEventListener('DOMContentLoaded', function() {
        // إعداد المؤهلات والتخصصات
        engine.loadQualifications();
        engine.loadSpecializations();
        engine.loadColleges();
        
        // تحديث الحقول المشروطة
        State.updateRequiredFields();
        
        // تحديث المؤشر
        engine.updateStatusIndicator('النظام جاهز للتشغيل');
        
        // تحديث التوصيات الأولية
        engine.updateStep1Recommendation();
        
        // تحديث معالج تغيير نوع المتقدم
        document.getElementById('applicantType').addEventListener('change', function() {
            State.updateRequiredFields();
        });
        
        // إضافة حدث لعرض الأخطاء
        document.getElementById('errorMessage').addEventListener('click', function() {
            this.style.display = 'none';
        });
        
        console.log('✅ النظام جاهز للاستخدام!');
        console.log('🔑 مفتاح Web3Forms: 8f907260-fc10-46e0-b5b6-422b56f45c19');
    });

    // دالة مساعدة لاختبار الاتصال (يمكن استدعاؤها من وحدة تحكم المتصفح)
    function testConnection() {
        engine.testWeb3FormsConnection();
    }
    </script>
</body>
                                  </html>
